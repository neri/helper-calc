# ライブコーディング用設計書: 助っ人貸出回数計算機

## 概要
このプロジェクトは、ユーザーが入力した「報酬」と「時間」から、「助っ人の貸し出し」回数を推定する計算機 (Single Page Application) を実装します。アプリはオフラインで動作し、外部通信を行いません。ライブコーディングのデモンストレーションとして、シンプルで理解しやすい設計を採用します。

## 技術スタック
- **言語**: TypeScript
- **ビルドツール**: Vite
- **パッケージマネージャー**: pnpm
- **フレームワーク**: なし (Vanilla TypeScript + HTML/CSS)
- **実行環境**: ブラウザ (SPA)

## 機能仕様
### 主要機能
- ユーザーが「現在の報酬」と「経過時間」を入力 (「登録時間」(時間単位) または「設定日時」(YYYY-MM-DDTHH:MM形式、ロケール依存表示) のいずれかを選択)。
- 入力に基づき、「貸し出し」回数を推定して表示。
- 推定結果は入力が止まってから0.5秒後に更新 (デバウンス処理)。
- 計算結果の貸出回数が0より小さい場合は、結果を表示しない。
- 獲得報酬は20の倍数のみ有効 (それ以外は結果非表示)。
- ローカルストレージ: 入力モード、登録時間、設定日時を保存 (獲得報酬は保存しない)。

### 計算ロジック
- **報酬増加のルール**:
  - 時間経過: 1分ごとに20ポイント増加。
  - 貸し出し: 1回あたり50,000ポイント増加。
- **時間の扱い**:
  - 登録時間入力時: 1時間単位 (例: 1時間、2時間)、実際の時間は1:00〜1:59の範囲 (60分〜119分) を考慮。
  - 設定日時入力時: 設定日時から現在までの経過時間を分単位で計算 (10分の誤差は許容)。
- **推定式**:
  - 登録時間入力時: 推定貸出回数 C = floor( (獲得報酬 B - (登録時間 A × 60分) × 20) / 50,000 )
  - 設定日時入力時: 推定貸出回数 C = floor( (獲得報酬 B - (経過時間 A 分) × 20) / 50,000 )
  - Cが負の場合: エラー「貸出回数が負です」(結果非表示)
  - 時間報酬 D = 獲得報酬 B - (C × 50,000)
  - 貸出回数報酬 E = C × 50,000
  - 報酬の範囲を計算: 最大報酬 = ((A × 60) + 59) × 20 + C × 50,000 (登録時間時)、または (A + 10) × 20 + C × 50,000 (設定日時時)
  - 入力報酬が最大報酬以下なら確定、そうでなければエラー「獲得報酬の値が計算範囲外です」。

### UI/UX 仕様
- **入力フォーム**:
  - 入力モード選択: タブ風のボタンで「登録時間」または「設定日時」を選択 (二者択一)。
  - 登録時間: 数値入力フィールド (「登録時間」選択時のみ有効、正の整数、単位: 時間)。
  - 設定日時: 日時入力フィールド (「設定日時」選択時のみ有効、YYYY-MM-DDTHH:MM形式、ロケール依存表示)。
  - 獲得報酬: 数値入力フィールド (必須、正の整数、20の倍数のみ有効)。
- **出力表示**:
  - 編成回数（推定）: 一番上に大きく表示 (3桁ごとにカンマ区切り、青色)。
  - 登録時間報酬: 獲得報酬から貸出回数報酬を引いた値 (3桁ごとにカンマ区切り)。
  - 編成回数報酬: 貸出回数 × 50,000 (3桁ごとにカンマ区切り)。
  - エラーメッセージ: 無効な入力時または計算範囲外時 (例: 負の数、ゼロ、または「獲得報酬の値が計算範囲外です」)。
- **レイアウト**:
  - シンプルな中央配置フォーム。
  - レスポンシブデザイン (モバイル対応)。
- **スタイル**: 基本的なCSSで装飾 (ボタン、フォームのスタイリング)。

## 実装計画
### プロジェクト構造
```
ts/
├── index.html          # メインHTMLファイル
├── src/
│   ├── main.ts         # エントリーポイント (TypeScript)
│   ├── app.ts          # アプリのメインクラス
│   ├── calculator.ts   # 計算ロジック
│   └── style.css       # CSSファイル
├── package.json        # 依存関係
├── tsconfig.json       # TypeScript設定
├── vite.config.ts      # Vite設定
└── test/
    └── calculator.test.ts  # テストファイル
```

### 実装ステップ (ライブコーディング順)
1. **プロジェクト初期化**: pnpm init, Viteセットアップ。
2. **HTML構造**: index.html の作成 (フォームと出力エリア)。
3. **TypeScript設定**: tsconfig.json の確認。
4. **計算ロジックの実装**: calculator.ts で推定関数を作成。
5. **メインアプリの実装**: app.ts でDOM操作とイベントハンドリング。
6. **エントリーポイント**: main.ts でアプリ起動。
7. **スタイリング**: style.css でUI装飾。
8. **テスト実行**: Vite dev server で動作確認。

### 考慮点
- **エラーハンドリング**: 入力値のバリデーション (数値チェック、範囲チェック)。エラーはカスタムクラス (InvalidInputError, NegativeLoanError, OutOfRangeError) で分類し、UIで適切に処理。
- **パフォーマンス**: 計算は軽量なので最適化不要。
- **拡張性**: 将来的に追加機能 (例: 詳細なログ) を考慮したモジュール化。
- **アクセシビリティ**: ラベル付け、キーボード操作対応。

## テストケース
- 入力: 登録時間=161, 獲得報酬=1,544,260 → 登録時間報酬=194,260, 貸出回数=27, 貸出回数報酬=1,350,000 (PASS)
- 入力: 登録時間=70, 獲得報酬=784,480 → 登録時間報酬=84,480, 貸出回数=14, 貸出回数報酬=700,000 (PASS)
- 入力: 登録時間=176, 獲得報酬=6,711,560 → 登録時間報酬=211,560, 貸出回数=130, 貸出回数報酬=6,500,000 (PASS)
- 入力: 登録時間=1, 獲得報酬=100,000 → 範囲外 → OutOfRangeError「獲得報酬の値が計算範囲外です」 (PASS)
- 入力: 登録時間=0, 獲得報酬=0 → 登録時間報酬=0, 貸出回数=0, 貸出回数報酬=0 (PASS)

この設計書に基づき、ライブコーディングで実装を進めます。質問があればお知らせください。